<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>çµå¸³ç¢ºèª</title>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <base href="/ui-ux/">
  <link rel="stylesheet" href="/ui-ux/css/checkout.css">
    <link rel="stylesheet" href="css/navbar.css">
    <link rel="stylesheet" href="css/cart.css">
</head>
<body>
    <div id="navbar-placeholder"></div>

  <div class="section">
    <h2>æœƒå“¡è³‡è¨Š</h2>
    <p>ğŸ‘‘ å¼µé‡‡ç²</p>
    <p>ç”Ÿæ—¥ï¼š2002å¹´3æœˆ18è™Ÿ</p>
    <p>Emailï¼šcailing0318@gmail.com</p>
  </div>

  <div class="section">
    <h2>å·²ä½¿ç”¨å„ªæƒ åˆ¸</h2>
    <label>
      å„ªæƒ åˆ¸ï¼š
      <input type="text" id="coupon-input" placeholder="è¼¸å…¥å„ªæƒ ç¢¼">
    </label>
    <button id="show-coupon-btn">å·²æœ‰å„ªæƒ åˆ¸</button>
    <div id="coupon-list" style="display:none; margin-top: 1rem;">
      <div class="coupon-card" data-code="FREE" data-type="shipping" style="border: 1px solid #ccc; padding: 1rem; margin-bottom: 0.5rem; cursor: pointer;">
        <h4>æ»¿ç™¾å…ƒå³äº«å…é‹å„ªæƒ </h4>
        <p>å„ªæƒ åˆ¸ä»£ç¢¼ï¼š<strong>FREE</strong></p>
        <span>ç„¡é–€æª»ï¼Œçµå¸³å¯é¸æ“‡å…é‹</span>
      </div>
      <div class="coupon-card" data-code="ALL" data-type="percent" data-value="0.95" style="border: 1px solid #ccc; padding: 1rem; margin-bottom: 0.5rem; cursor: pointer;">
        <h4>æ‰€æœ‰å•†å“ 95 æŠ˜</h4>
        <p>å„ªæƒ åˆ¸ä»£ç¢¼ï¼š<strong>ALL</strong></p>
        <span>çµå¸³é‡‘é¡è‡ªå‹•æ‰“ 95 æŠ˜</span>
      </div>
      <div class="coupon-card" data-code="Only" data-type="item" data-value="0.85" style="border: 1px solid #ccc; padding: 1rem; margin-bottom: 0.5rem; cursor: pointer;">
        <h4>æŒ‡å®šå“é … 85 æŠ˜</h4>
        <p>å„ªæƒ åˆ¸ä»£ç¢¼ï¼š<strong>Only</strong></p>
        <span>é™æŒ‡å®šå•†å“å¯ä½¿ç”¨</span>
      </div>
    </div>
    <p id="coupon-display">ï¼ˆæœªä½¿ç”¨ï¼‰</p>
  </div>
  

  <div class="section">
    <h2>è³¼ç‰©è»Šå…§å®¹</h2>
    <div id="cart-items"></div>
    <div class="summary" id="summary"></div>
  </div>

  <script>
    const data = JSON.parse(sessionStorage.getItem('checkoutData'));
    if (data) {
      let discount = 1;
      let usedCoupon = '';
  
      // é¡¯ç¤ºåˆå§‹å…§å®¹
      document.getElementById('coupon-display').textContent = data.couponCode || 'ï¼ˆæœªä½¿ç”¨ï¼‰';
      const cartItems = document.getElementById('cart-items');
      data.items.forEach(item => {
        const div = document.createElement('div');
        div.className = 'cart-item';
        div.innerHTML = `<div>${item.name} (${item.consumptionType}) x ${item.quantity}</div><div>$${(item.price * item.quantity).toFixed(2)}</div>`;
        cartItems.appendChild(div);
      });
  
      // é¡¯ç¤ºç¸½è¨ˆ
      const summaryEl = document.getElementById('summary');
      function updateSummary() {
        const discountedTotal = (data.total * discount).toFixed(0);
        summaryEl.textContent = `å•†å“ç¸½æ•¸ï¼š${data.totalCount}ã€€ç¸½é‡‘é¡ï¼šNT$${discountedTotal}${usedCoupon ? `ï¼ˆå·²ä½¿ç”¨ ${usedCoupon}ï¼‰` : ''}`;
      }
      updateSummary();
  
      // é»æŒ‰éˆ•é¡¯ç¤ºå„ªæƒ åˆ¸åˆ—è¡¨
      document.getElementById('show-coupon-btn').onclick = () => {
        document.getElementById('coupon-list').style.display = 'block';
      };
  
      // é»é¸å„ªæƒ åˆ¸å¡ç‰‡
      document.querySelectorAll('.coupon-card').forEach(card => {
        card.onclick = () => {
          usedCoupon = card.dataset.code;
          document.getElementById('coupon-display').textContent = usedCoupon;
          // æ ¹æ“šå„ªæƒ é¡å‹æ±ºå®šæŠ˜æ‰£
          if (card.dataset.type === 'percent') {
            discount = parseFloat(card.dataset.value);
          } else if (card.dataset.type === 'shipping') {
            // é€™è£¡å¯ä»¥å¦è¨­ shipping cost é‚è¼¯ï¼Œæ­¤ä¾‹å…é‹ä¸èª¿æ•´å•†å“ç¸½é¡
            discount = 1;
          } else if (card.dataset.type === 'item') {
            // ç°¡åŒ–è™•ç†ç‚ºå…¨å–® 85 æŠ˜
            discount = parseFloat(card.dataset.value);
          }
          updateSummary();
        };
      });
    }
  </script>
  <!-- å°èˆªæ¬„å›ºå®šçš„è¨­è¨ˆ -->
  <script>
    $(function(){
        $("#navbar-placeholder").load("./component/navbar.html", function() {
            // å¯é¸ï¼šé«˜äº®ç•¶å‰é é¢
            const currentPage = window.location.pathname.split('/').pop();
            $("#navbar-placeholder a").each(function() {
                if ($(this).attr("href").includes(currentPage)) {
                    $(this).addClass("active");
                }
            });
        });

        // å¹³æ»‘æ»¾å‹•æ•ˆæœ
        $('a[href^="#"]').on('click', function(event) {
            event.preventDefault();
            
            const target = $(this.getAttribute('href'));
            if (target.length) {
                $('html, body').animate({
                    scrollTop: target.offset().top - 80 // æ¸›å»å°èˆªæ¬„é«˜åº¦
                }, 1000);
            }
        });
    });
</script>
</body>
</html>
